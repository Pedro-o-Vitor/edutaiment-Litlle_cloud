<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Itens na nuvem</title>
<link rel="manifest" href="/manifest.json">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
body { margin:0; padding:0; width:100vw; height:100vh; background: linear-gradient(135deg,#a7d0f3,#e8c7ff); font-family:'Inter',sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; overflow:hidden; color:#311b92; }
.back-button:hover, #restart-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
  }
  .back-button { left: 20px; }
  #restart-button { right: 20px; }


   .next-button, #restart-button, .back-button {
            position: fixed;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            z-index: 20;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-size: 2rem;
            color: white;
            font-weight: bold;
            border: 4px solid #fff;
        }
        .next-button { top: 20px; right: 20px; background: linear-gradient(135deg, #e0aaff, #aa22ff); }
        #restart-button { top: 50%; left: 10%; transform: translateX(-50%); background: linear-gradient(135deg, #e0aaff, #aa22ff); }
        .back-button { top: 20px; left: 20px; background: linear-gradient(135deg, #e0aaff, #aa22ff); }
        .next-button:active, #restart-button:active, .back-button:active {
            transform: scale(0.9) translateX(-50%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

.game-container { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:2rem; background-color: rgba(255,255,255,0.5); backdrop-filter: blur(15px); border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.15); height:500px; }
h1 { font-size:2.5rem; font-weight:900; color:#4a148c; margin-bottom:0.5rem; }
#instruction-text { font-size:1.2rem; font-weight:700; color:#6a1b9a; margin-bottom:2rem; }
.main-game-area { display:flex; justify-content:center; align-items:flex-start; gap:3rem; margin-bottom:3rem; position:relative; }
#cloud-container { position:relative; width:500px; height:250px; display:flex; justify-content:center; align-items:center; animation: float 4s ease-in-out infinite; }
@keyframes float { 0% {transform:translateY(0);} 50% {transform:translateY(-12px);} 100% {transform:translateY(0);} }
#cloud-container img.cloud-bg { width:100%; height:100%; object-fit:contain; }
#cloud-item { position:absolute; top:50%; left:50%; width:200px; height:200px; transform:translate(-50%, -50%); pointer-events:none; transition: all 0.5s ease; opacity:0.3; }
#robot { width:600px; height:auto; transition: transform 0.3s; position:relative; z-index:2; }
.options { display:flex; gap:10rem; }
.option { width:200px; height:200px; background: linear-gradient(145deg,#bbfffe,#d0d7fd); display:flex; justify-content:center; align-items:center; border-radius:20px; cursor:grab; box-shadow:6px 6px 12px rgba(0,0,0,0.2), -6px -6px 12px rgba(255,255,255,0.5); transition: transform 0.3s, box-shadow 0.3s; transform-style: preserve-3d; }
.option img { max-width:80%; max-height:80%; }
.option.hidden { display:none; }
.option.dragging { opacity:0; }
@keyframes danceAnim { 0%{transform:rotate(0deg);} 25%{transform:rotate(15deg);} 50%{transform:rotate(-15deg);} 75%{transform:rotate(15deg);} 100%{transform:rotate(0deg);} }
#robot.dance { animation:danceAnim 1s ease; }
.option:hover { transform:translateY(-5px) scale(1.05); box-shadow:8px 8px 16px rgba(0,0,0,0.3), -8px -8px 16px rgba(255,255,255,0.6); }
#cloud-container.correct { box-shadow:0 0 30px 10px #ffeb3b; transition: box-shadow 0.3s ease-in-out; }
/* PARTICULAS */
.particle { position:absolute; width:10px; height:10px; border-radius:50%; opacity:0.8; pointer-events:none; animation:fall linear; }
@keyframes fall { 0%{transform:translateY(0);} 100%{transform:translateY(600px);} }
</style>
</head>
<body>
<a href="jogos.html" class="back-button" style="left:2rem;">⬅</a>
<button id="restart-button" class="back-button" style="left:auto; right:2rem;">⟳</button>

   <div id="start-screen" style="
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(135deg,#fbc2eb,#a6c0fe);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 9999;
">
    <h1 style="
        color: #fff;
        font-size: 2.5rem;
        text-align: center;
        text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
        margin-bottom: 20px;
    ">Bem-vindo ao Itens na nuvem!</h1>
    <button id="start-game-btn" style="
        padding:0.8rem 2.5rem;
        font-size:1rem;
        border-radius:100px;
        border:none;
        background: linear-gradient(135deg,#5c8dff,#ff60d2);
        color:white;
        cursor:pointer;
        font-weight:bold;
        text-shadow:1px 1px 2px rgba(0,0,0,0.2);
    ">Começar</button>
</div>


<div class="game-container">
    <h1>Arraste o item para a nuvem!</h1>
    <p id="instruction-text">Arraste a música para a nuvem.</p>

    <div class="main-game-area">
        <div id="cloud-container">
            <img src="nuvem2.png" alt="Nuvem" class="cloud-bg">
            <img id="cloud-item" src="" alt="Item esperado">
        </div>
    </div>

    <div class="options">
        <div class="option" id="music" draggable="true">
            <img src="musica2.png" alt="Música">
        </div>
        <div class="option" id="photo" draggable="true">
            <img src="foto2.png" alt="Foto">
        </div>
        <div class="option" id="game" draggable="true">
            <img src="videogame2.png" alt="Videogame">
        </div>
    </div>
</div>

<!-- SONS -->
<audio id="victory-sound" src="itenscarregados.mp3" preload="auto"></audio>
<audio id="correct-sound" src="itemcorreto.mp3" preload="auto"></audio>
<audio id="wrong-sound" src="itemerrado.mp3" preload="auto"></audio>
<audio id="robot-music-sound" src="robomusica.mp3" preload="auto"></audio>
<audio id="robot-photo-sound" src="robofoto.mp3" preload="auto"></audio>
<audio id="robot-game-sound" src="robojogo.mp3" preload="auto"></audio>

<script>
const cloudContainer = document.getElementById('cloud-container');
const cloudItem = document.getElementById('cloud-item');
const instructionText = document.getElementById('instruction-text');

const sequence=['music','photo','game'];
const itemImages={music:"musica2.png", photo:"foto2.png", game:"videogame2.png"};
const instructionSequence=[
    'Arraste a música para a nuvem.',
    'Agora, arraste a foto para a nuvem.',
    'Por fim, arraste o videogame para a nuvem.'
];
const robotGifs={music:"robodanca (3).gif", photo:"robofoto.gif", game:"robojogo.gif"};

let current=0;
let robot;
let currentRobotSound=null;
let particlesInterval=null;

// MOSTRAR PRIMEIRO ITEM
cloudItem.src=itemImages[sequence[current]];
cloudItem.style.opacity=0.3;

// DRAG & DROP
document.querySelectorAll('.option').forEach(item=>{
    item.addEventListener('dragstart', e=>{
        e.dataTransfer.setData('text/plain', e.currentTarget.id);
        e.currentTarget.classList.add('dragging');
        const ghost=e.currentTarget.cloneNode(true);
        ghost.style.position="absolute";
        ghost.style.top="-1000px";
        ghost.style.left="-1000px";
        ghost.style.opacity="1";
        document.body.appendChild(ghost);
        e.dataTransfer.setDragImage(ghost, ghost.offsetWidth/2, ghost.offsetHeight/2);
        setTimeout(()=>document.body.removeChild(ghost),0);
    });
    item.addEventListener('dragend', e=>{
        if(!e.currentTarget.classList.contains('hidden')){
            e.currentTarget.classList.remove('dragging');
        }
    });
});

cloudContainer.addEventListener('dragover', e=>e.preventDefault());

cloudContainer.addEventListener('drop', e=>{
    e.preventDefault();
    const id=e.dataTransfer.getData('text/plain');
    const draggedElement=document.getElementById(id);
    draggedElement.classList.remove('dragging');

    if(currentRobotSound){
        currentRobotSound.loop=false;
        currentRobotSound.pause();
        currentRobotSound.currentTime=0;
        currentRobotSound=null;
    }

    if(id===sequence[current]){
        document.getElementById("correct-sound").play();

        if(!robot){
            robot=document.createElement('img');
            robot.id='robot';
            robot.src=robotGifs[id];
            robot.style.width='600px';
            robot.style.height='auto';
            robot.style.transition='transform 0.3s';
            document.querySelector('.main-game-area').appendChild(robot);
        }else{
            robot.src=robotGifs[id];
        }
        robot.classList.add('dance');
        setTimeout(()=>robot.classList.remove('dance'),1000);

        if(id==='music') currentRobotSound=document.getElementById("robot-music-sound");
        if(id==='photo') currentRobotSound=document.getElementById("robot-photo-sound");
        if(id==='game') currentRobotSound=document.getElementById("robot-game-sound");

        currentRobotSound.currentTime=0;
        currentRobotSound.loop=true;
        currentRobotSound.play();

        cloudContainer.classList.add('correct');
        setTimeout(()=>cloudContainer.classList.remove('correct'),300);

        cloudItem.src=itemImages[id];
        cloudItem.style.opacity=1;

        draggedElement.classList.add('hidden');
        current++;

        if(current<sequence.length){
            setTimeout(()=>{
                cloudItem.src=itemImages[sequence[current]];
                cloudItem.style.opacity=0.3;
                instructionText.textContent=instructionSequence[current];
            },3000);
        }else{
            // Vitória: apenas registrar no histórico
            startGame();
        }
    }else{
        document.getElementById("wrong-sound").play();
        draggedElement.classList.remove('dragging');
    }
});

// FUNÇÃO PARTICULAS
function startParticles(){
    if(particlesInterval) clearInterval(particlesInterval);
    particlesInterval=setInterval(()=>{
        const particle=document.createElement('div');
        particle.classList.add('particle');
        particle.style.backgroundColor=`hsl(${Math.random()*360},70%,60%)`;
        particle.style.left=Math.random()*window.innerWidth+'px';
        particle.style.animationDuration=2+Math.random()*2+'s';
        document.body.appendChild(particle);
        setTimeout(()=>particle.remove(),3000);
    },100);
}

function stopParticles(){
    if(particlesInterval) clearInterval(particlesInterval);
}

// CONTROLE PARENTAL
function startTimerGame(){
    clearInterval(window.limitCheckerGame);
    window.limitCheckerGame = setInterval(()=>{
        const gameLimit = parseInt(localStorage.getItem('gameLimit')) || 0;
        const gameStart = parseInt(localStorage.getItem('gameStart')) || 0;
        if(gameLimit && gameStart){
            const elapsed = (Date.now() - gameStart) / 1000;
            if(elapsed >= gameLimit){
                clearInterval(window.limitCheckerGame);
                const lock = document.getElementById("lock-screen");
                if(lock) lock.style.display = "flex";
            }
        }
    }, 1000);
}

function unlockGame(){
    const input = document.getElementById("unlockPassword").value;
    const savedPassword = localStorage.getItem("parentPassword") || "1234";
    const feedback = document.getElementById("unlockFeedback");
    if(input === savedPassword){
        document.getElementById("lock-screen").style.display = "none";
        document.getElementById("unlockPassword").value = "";
        feedback.textContent = "";
        localStorage.setItem('gameStart', Date.now());
        startTimerGame();
    } else {
        feedback.textContent = "Senha incorreta!";
    }
}

if(localStorage.getItem('gameLimit') && localStorage.getItem('gameStart')){
    startTimerGame();
}

// FUNÇÃO PARA SALVAR HISTÓRICO
function startGame() {
    const gameName = "Arrastar e soltar";
    let historico = JSON.parse(localStorage.getItem("gameHistory")) || {};
    if (!historico[gameName]) {
        historico[gameName] = { plays: 0 };
    }
    historico[gameName].plays += 1;
    localStorage.setItem("gameHistory", JSON.stringify(historico));
}

// BOTÃO RESTART
const restartButton = document.getElementById('restart-button');

restartButton.addEventListener('click', () => {
    current = 0;
    cloudItem.src = itemImages[sequence[current]];
    cloudItem.style.opacity = 0.3;
    instructionText.textContent = instructionSequence[current];
    document.querySelectorAll('.option').forEach(opt => opt.classList.remove('hidden', 'dragging'));
    
    if(robot){
        robot.remove();
        robot = null;
    }
    
    if(currentRobotSound){
        currentRobotSound.loop = false;
        currentRobotSound.pause();
        currentRobotSound.currentTime = 0;
        currentRobotSound = null;
    }

    stopParticles();
});
constentranceSound = new Audio('oqueenuvem.mp3'); // primeiro som
constafterSound = new Audio('conecteoscabos.mp3'); // segundo som

document.getElementById("start-game-btn").addEventListener("click", function() {
    // Esconde a tela inicial
    document.getElementById("start-screen").style.display = "none";

    // Garante que o evento 'ended' do primeiro som está registrado antes de tocar
    entranceSound.addEventListener("ended", () => {
        afterSound.play().catch(e => console.warn("Erro ao tocar o segundo som:", e));
    }, { once: true }); // 'once' evita múltiplos disparos

    // Toca o primeiro som
    entranceSound.play().catch(e => console.warn("Erro ao tocar o primeiro som:", e));
});

</script>
<script src="/register-sw.js"></script>
</body>
</html>
